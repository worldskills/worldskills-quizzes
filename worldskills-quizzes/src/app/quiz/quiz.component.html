<ng-container *ngIf="quiz">
  <div class="row">
    <div class="col-sm-offset-2 col-sm-8">

      <div class="page-header">
        <h2>{{quiz.title.text || " "}}</h2>
        <!--      <h2 *ngIf="!quizError">{{quiz.title.text || " "}}</h2>-->
        <!--      <h2 *ngIf="quizError">{{ quizError.status == 404 ? "Quiz not found" : quizError.status + " " + quizError.statusText }}</h2>-->
      </div>

      <!--    <ws-spinner *ngIf="loading"></ws-spinner>-->

      <div *ngIf="attempt.state === 'finished' && attempt.passed === false"
           class="alert alert-danger"
           role="alert">
        Your attempt failed with <strong>{{attempt.score}} of {{attempt.questions_count}}</strong>
        answers correct. <a href="" class="alert-link" ng-click="retry()">Please take the quiz
        again</a>.
      </div>
      <div *ngIf="attempt.state === 'finished' && attempt.passed === true"
           class="alert alert-success"
           role="alert">
        You have passed with <strong>{{attempt.score}} of {{attempt.questions_count}}</strong>
        answers
        correct<span *ngIf="quiz.url_success">, <a href="{{quiz.url_success}}" class="alert-link">please continue</a></span>.
      </div>
      <div *ngIf="attempt.state === 'running'">
        <p>
          Your answers are automatically saved, to finish this attempt click “Submit and finish
          Quiz”
          at the end of the page.
          <span
            *ngIf="quiz.required_score_pass === null">All answers must be correct to pass.</span>
          <span
            *ngIf="quiz.required_score_pass !== null">You need to answer <strong>{{quiz.required_score_pass}}</strong> questions correctly to pass.</span>
        </p>
        <br/>
      </div>

      <!--    <div *ngIf="quizError" class="alert alert-danger" role="alert">{{ quizError.status == 404 ? "The requested Quiz could not be found." : "The requested Quiz is unavailable." }}</div>-->
      <!--    <div *ngIf="!quizError && attemptError.status == 401" class="alert alert-danger" role="alert">You do not have the required permissions to attempt this Quiz.</div>-->
      <!--    <div *ngIf="attemptError.status == 400 && attemptError.data.code == '1300-403'" class="alert alert-warning" role="alert">The Quiz has been closed and is no longer active.</div>-->
      <ng-container *ngIf="attempt">
        <ng-container *ngFor="let question of attempt.questions">
          <div class="panel"
               ng-class="{'panel-default': question.correct === null, 'panel-danger': question.correct === false, 'panel-success': question.correct === true}"
          >
            <div class="panel-heading">
              <h3 class="panel-title">Question {{question.sort}}</h3>
            </div>
            <div class="panel-body">
              <div class="lead" ng-bind-html="question.text.text"></div>
              <div class="form-group">
                <div class="radio" *ngFor="let answer of question.answers">
                  <label>
                    <input type="radio" ng-model="question.answer.id" ng-change="selectAnswer()"
                           ng-value="answer.id" ng-disabled="attempt.state === 'finished'">
                    <span
                      ng-class="{'text-danger': question.answer.id === answer.id && question.correct === false, 'text-success': (question.answer.id === answer.id && question.correct === true) || (answer.correct === true && question.correct === false)}">
                                {{alphabet[answer.sort - 1]}}: <span
                      ng-bind-html="answer.text.text"></span>
                            </span>
                    <span class="label label-danger"
                          *ngIf="question.answer.id === answer.id && question.correct === false">Incorrect</span>
                    <span class="label label-success"
                          *ngIf="(question.answer.id === answer.id && question.correct === true) || (answer.correct === true && question.correct === false)">Correct</span>
                  </label>
                </div>
              </div>
            </div>
          </div>
        </ng-container>

        <div class="row">
          <div class="col-sm-6">
            <button type="submit" class="btn btn-primary" *ngIf="attempt.state === 'running'"
                    ng-click="finish()">
              Submit and finish Quiz
              <!--          <ws-text-spinner *ngIf="finishLoading" class="ng-hide"></ws-text-spinner>-->
            </button>

            <button type="button" class="btn btn-primary" *ngIf="attempt.state === 'finished'"
                    ng-click="retry()">
              Take Quiz again
            </button>
          </div>

          <!--           *ngIf="quiz.url_learning && (attempt.state === 'running' || attempt.passed === false || attemptError.status == 400 || attemptError.status == 401)"-->
          <div class="col-sm-6">
            <a class="btn btn-link pull-right"
               *ngIf="quiz.url_learning && (attempt.state === 'running' || attempt.passed === false)"
               href="{{quiz.url_learning}}">« Return to learning resources</a>

            <a class="btn btn-success pull-right"
               *ngIf="attempt.state === 'finished' && attempt.passed === true && quiz.url_success"
               href="{{quiz.url_success}}">Continue »</a>
          </div>
        </div>
      </ng-container>
    </div>
  </div>
</ng-container>
